name: 🚀 Scraping Automatique Courir.com

on:
  schedule:
    - cron: '*/30 * * * *'  # ⏰ Toutes les 30 minutes
  workflow_dispatch:         # 🎮 Déclenchement manuel

jobs:
  scrape:
    runs-on: ubuntu-latest   # 💻 Machine virtuelle Ubuntu
    timeout-minutes: 20      # ⏱️ Maximum 20 minutes d'exécution

    env:
      SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
      SUPABASE_SERVICE_ROLE: ${{ secrets.SUPABASE_SERVICE_ROLE }}

    steps:
    # Étape 1: 📥 Télécharger le code
    - name: Checkout du code
      uses: actions/checkout@v4

    # Étape 2: 🐍 Installer Python
    - name: Installation de Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    # Étape 3: 📦 Installer les dépendances
    - name: Installation des dépendances
      run: pip install -r scripts/requirements.txt

    # Étape 4: 🕷️ Lancer le scraping
    - name: Exécution du scraping
      run: |
        cd scripts
        python scraper.py
